.ZVERSION 3

.ZHEADER StatLineType 0
.ZHEADER StoryfileSplit 0
.ZHEADER Tandy 0
.ZHEADER ReleaseNumber 0x42
.ZHEADER SerialNum "421337"
.ZHEADER CompilerVer 0x1337
.ZHEADER InitialPC15 entry

.OBJECTS
.PROPERTY 1  1, 0
.PROPERTY 15 255, 128
.OBJECT "HELLO" {
	.ATTRIBUTE 0
	.ATTRIBUTE 4
	
	.PROPERTY 1 "Hello"
	.OBJECT "WORLD" {
		.PROPERTY 1 "World"
	}
	.OBJECT "!" {
		.PROPERTY 1 "!"
	}
}

.GLOBALS
.GLOBAL bsdf entry
.GLOBAL csdf 0
.GLOBAL dsdf

.SECTION static

.DICTIONARY '.' ',' '"'
.KEY "mail"
.DATA 1 BYTE 00
.KEY "door"
.DATA 1 BYTE 00
.KEY "hit"
.DATA 1 BYTE 01
.DATA 2 BYTE testroutine


entry:
verify ? checksum_match
print "checksum wrong!\n"
// Unfortunately, the unconditional branch is asinine to use.
jz 0 ? checksum_after
checksum_match:
print "checksum verified!\n"
checksum_after:
call testroutine -> sp
print_obj 1
test_attr 1, 4 ? attr4_set
print "obj1.attribute4 is unset! (incorrect)\n"
jz 0 ? attr4_after
attr4_set:
print "obj1.attribute4 is set! (correct)\n"
attr4_after:

test_attr 1, 2 ? attr2_set
print "obj1.attribute2 is unset! (correct)\n"
jz 0 ? attr2_after
attr2_set:
print "obj1.attribute2 is set! (incorrect)\n"
attr2_after:

quit

// In practice, it's nonsensical why code should be before the high memory mark - this is just for testing.
// Code before the high memory mark shouldn't cause problems, so no diagnostic is expected.
.SECTION high

.ROUTINE testroutine
.LOCAL asdf
print "Hello from testroutine!\n"
rtrue
